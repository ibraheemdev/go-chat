<!DOCTYPE html>
<html lang="en">

<head>
	<title>Golang WebSocket Chatrooms</title>
	<script type="text/javascript">
		window.onload = () => {
			var conn;
			var log = document.getElementById("log");
			var message = document.getElementById("message");
			document.getElementById("join-room").addEventListener("submit", (evt) => {
				evt.preventDefault();
				console.log("ASddsaasd");
				room = document.getElementById("chatroom").value;
				conn = new WebSocket("ws://0.0.0.0:8080/chat/" + room);
				conn.onmessage = (evt) =>
					log.insertAdjacentHTML("beforeend", `<div>${evt.data}</div>`);
				document.getElementById("join-room").style.display = "none";
				document.getElementById("send-message").style.display = "block";
				document.getElementById("room-name").textContent = room + " chatroom";
			});
			document.getElementById("send-message").addEventListener("submit", (evt) => {
				evt.preventDefault();
				if (!message.value) return;
				if (!conn) return;
				conn.send(message.value);
				message.focus();
				message.value = "";
			});
			document.getElementById("leave-room").addEventListener("click", () => {
				conn.close();
				document.getElementById("room-name").textContent = "";
				while (log.firstChild) log.removeChild(log.firstChild);
				document.getElementById("send-message").style.display = "none";
				document.getElementById("join-room").style.display = "block";
			}, false);
		};
	</script>
</head>

<body>

	<form id="join-room">
		<h2>Chat Sign In</h2>
		<select size="1" id="chatroom">
			<option>arduino</option>
			<option>java</option>
			<option>go</option>
			<option>scala</option>
		</select>
		<button type="submit">Join Chatroom</button>
	</form>
	<form id="send-message" style="display: none;">
		<h2 id="room-name"></h2>
		<div id="log"></div>
		<input type="text" placeholder="Enter your message..." id="message" />
		<input type="submit" value="Send message" />
		<button type="button" id="leave-room">Leave room</button>
	</form>
</body>

</html>