<!DOCTYPE html>
<html lang="en">

<head>
	<title>Golang WebSocket Chatrooms</title>
	<script type="text/javascript">
		window.onload = () => {
			var conn;
			var log = document.getElementById("log");
			var msg = document.getElementById("msg");
			document.getElementById("join-room").addEventListener("submit", (evt) => {
				if (window["WebSocket"]) {
					evt.preventDefault();
					console.log("ASddsaasd");
					room = document.getElementById("chatroom").value;
					conn = new WebSocket("ws://0.0.0.0:8080/chat/" + room);
					conn.onmessage = (evt) =>
						log.insertAdjacentHTML("beforeend", `<div>${evt.data}</div>`);
					document.getElementById("join-room").style.display = "none";
					document.getElementById("send-msg").style.display = "block";
					document.getElementById("room-name").textContent = room + " chatroom";
				} else {
					document.getElementById("room-name").textContent =
						"Your browser does not support WebSockets."
				}
			});
			document.getElementById("send-msg").addEventListener("submit", (evt) => {
				evt.preventDefault();
				if (!msg.value) return;
				if (!conn) return;
				conn.send(msg.value);
				msg.focus();
				msg.value = "";
			});
			document.getElementById("leave-room").addEventListener("click", () => {
				conn.close();
				document.getElementById("room-name").textContent = "";
				while (log.firstChild) log.removeChild(log.firstChild);
				document.getElementById("send-msg").style.display = "none";
				document.getElementById("join-room").style.display = "block";
			}, false);
		};
	</script>
</head>

<body>

	<form id="join-room">
		<h2>Chat Sign In</h2>
		<select size="1" id="chatroom">
			<option>arduino</option>
			<option>java</option>
			<option>go</option>
			<option>scala</option>
		</select>
		<button type="submit">Join Chatroom</button>
	</form>
	<form id="send-msg" style="display: none;">
		<h2 id="room-name"></h2>
		<div id="log"></div>
		<input type="text" placeholder="Enter your msg..." id="msg" />
		<input type="submit" value="Send msg" />
		<button type="button" id="leave-room">Leave room</button>
	</form>
</body>

</html>